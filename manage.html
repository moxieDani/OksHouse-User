<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜ˆì•½ í™•ì¸/ë³€ê²½ - Ok's House</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/calendar.css">
    <link rel="stylesheet" href="css/privacy.css">
    <link rel="stylesheet" href="css/manage.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1><span class="emoji-normal">âš™ï¸</span> Ok's ëŸ¬ë¸Œí•˜ìš°ìŠ¤ ì˜ˆì•½ í™•ì¸</h1>
        
        
        <!-- Step 1: ì˜ˆì•½ì ì •ë³´ ì…ë ¥ -->
        <div class="step" id="step1">
            <h3><span class="emoji-normal">ğŸ”‘</span> 1ë‹¨ê³„: ì˜ˆì•½ì ì¸ì¦</h3>
            <p class="step-description">
                ì˜ˆì•½ ì‹œ ì…ë ¥í•˜ì‹  ì •ë³´ë¥¼ ë™ì¼í•˜ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”. ë¹„ë°€ë²ˆí˜¸ëŠ” ì˜ˆì•½ ì‹œ ì„¤ì •í•˜ì‹  4ìë¦¬ ìˆ«ìì…ë‹ˆë‹¤.
            </p>
            <div class="form-group">
                <label for="auth-name">ì´ë¦„:</label>
                <input type="text" id="auth-name" placeholder="ì˜ˆì•½ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="form-group">
                <label for="auth-phone">ì „í™”ë²ˆí˜¸:</label>
                <input type="tel" id="auth-phone" placeholder="010-1234-5678">
            </div>
            <div class="form-group">
                <label for="password">ë¹„ë°€ë²ˆí˜¸:</label>
                <input type="password" id="password" placeholder="4ìë¦¬ ìˆ«ì ë¹„ë°€ë²ˆí˜¸">
            </div>
            <div class="button-container">
                <button class="btn btn-back" onclick="location.href='index.html'">ì´ì „</button>
                <button class="btn" onclick="nextStep(1)">í™•ì¸</button>
            </div>
        </div>

        <!-- Step 2: ì˜ˆì•½ ëª©ë¡ í™•ì¸ -->
        <div class="step hidden" id="step2">
            <h3><span class="emoji-normal">ğŸ“Š</span> 2ë‹¨ê³„: ì˜ˆì•½ í˜„í™© í™•ì¸</h3>
            <p class="step-description">
                ì•„ë˜ ë‹¬ë ¥ê³¼ ì˜ˆì•½ ëª©ë¡ì—ì„œ ë³€ê²½í•˜ê±°ë‚˜ ì·¨ì†Œí•  ì˜ˆì•½ì„ ì„ íƒí•´ì£¼ì„¸ìš”.
            </p>
            
            <!-- ë‹¬ë ¥ ë³´ê¸° -->
            <div class="calendar-view">
                <div id="calendar-container"></div>
            </div>
            
            <!-- ì˜ˆì•½ ëª©ë¡ -->
            <div style="margin-top: 20px;">
                <h4><span class="emoji-normal">ğŸ“ˆ</span> ë‚´ ì˜ˆì•½ ëª©ë¡</h4>
                <div id="reservations-list">
                    <!-- ì˜ˆì•½ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </div>
            
            <div class="button-container step2-buttons" style="text-align: center; margin-top: 20px; display: flex; gap: 6px; justify-content: center; flex-wrap: nowrap;">
                <button class="btn btn-back compact-btn" onclick="prevStep(2)">ì´ì „</button>
                <button class="btn compact-btn" id="nextBtn2" onclick="startReservationModification()" disabled style="opacity: 0.5; cursor: not-allowed;">ì˜ˆì•½ ë³€ê²½</button>
                <button class="btn compact-btn" id="cancelBtn2" onclick="cancelSelectedReservation()" disabled style="opacity: 0.5; cursor: not-allowed; background: #e74c3c;">ì˜ˆì•½ ì·¨ì†Œ</button>
            </div>
        </div>

        <!-- Step 3: ì˜ˆì•½ ë³€ê²½/ì‚­ì œ -->
        <div class="step hidden" id="step3">
            <h3><span class="emoji-normal">âš™ï¸</span> 3ë‹¨ê³„: ì˜ˆì•½ ë³€ê²½ ë° ì·¨ì†Œ</h3>
            <p class="step-description">
                ì„ íƒí•˜ì‹  ì˜ˆì•½ì˜ ë‚ ì§œë¥¼ ë³€ê²½í•˜ê±°ë‚˜ ì˜ˆì•½ì„ ì™„ì „íˆ ì·¨ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>
            
            <!-- í˜„ì¬ ì„ íƒëœ ì˜ˆì•½ ì •ë³´ -->
            <div class="current-reservation" id="selected-reservation-info">
                ì„ íƒëœ ì˜ˆì•½ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤
            </div>
            
            <!-- ë³€ê²½ ì˜µì…˜ -->
            <div class="modify-form" id="modify-form" style="display: none;">
                <h4>ìƒˆë¡œìš´ ì˜ˆì•½ ì •ë³´</h4>
                
                <!-- ìƒˆë¡œìš´ ìˆ™ë°• ê¸°ê°„ ì„ íƒ -->
                <div class="form-group">
                    <label>ìƒˆë¡œìš´ ìˆ™ë°• ê¸°ê°„:</label>
                    <div class="duration-buttons">
                        <button class="duration-btn" onclick="selectDuration(1, this)">1ë°• 2ì¼</button>
                        <button class="duration-btn" onclick="selectDuration(2, this)">2ë°• 3ì¼</button>
                        <button class="duration-btn" onclick="selectDuration(3, this)">3ë°• 4ì¼</button>
                        <button class="duration-btn" onclick="selectDuration(4, this)">4ë°• 5ì¼</button>
                        <button class="duration-btn" onclick="selectDuration(5, this)">5ë°• 6ì¼</button>
                        <button class="duration-btn" onclick="selectDuration(6, this)">6ë°• 7ì¼</button>
                        <button class="duration-btn" onclick="selectDuration(7, this)">7ë°• 8ì¼</button>
                        <button class="duration-btn" onclick="selectDuration(8, this)">8ë°• 9ì¼</button>
                        <button class="duration-btn" onclick="selectDuration(9, this)">9ë°• 10ì¼</button>
                        <button class="duration-btn" onclick="selectDuration(10, this)">10ë°• 11ì¼</button>
                    </div>
                </div>
                
                <!-- ìƒˆë¡œìš´ ë‚ ì§œ ì„ íƒ -->
                <div class="form-group" style="margin-top: 20px;">
                    <label>ìƒˆë¡œìš´ ì˜ˆì•½ ë‚ ì§œ:</label>
                    <div class="date-range-display" id="dateRangeDisplay">
                        ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”
                    </div>
                    <div id="modify-calendar-container"></div>
                </div>
            </div>
            
            <div class="button-container">
                <button class="btn btn-back" onclick="prevStep(3)">ì´ì „</button>
                <button class="btn" onclick="showModifyForm()" id="modify-btn">ì˜ˆì•½ ë³€ê²½</button>
                <button class="btn btn-delete" onclick="deleteReservation()" id="delete-btn">ì˜ˆì•½ ì‚­ì œ</button>
                <button class="btn" onclick="completeModification()" id="save-btn" style="display: none;">ë³€ê²½ ì €ì¥</button>
            </div>
        </div>
    </div>

    <script src="js/common.js"></script>
    <script src="js/calendar.js"></script>
    <script src="js/privacy.js"></script>
    <script>
        // Initialize components
        let stepNavigator, calendar, modifyCalendar, selectedReservation = null;
        
        // Mock reservation data - ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ ê°€ì ¸ì˜¬ ë°ì´í„°
        const mockReservations = [
            {
                id: 1,
                name: 'í™ê¸¸ë™',
                phone: '010-1234-5678',
                startDate: new Date(2025, 7, 10), // 8ì›” 10ì¼
                duration: 2,
                status: 'confirmed'
            },
            {
                id: 2,
                name: 'í™ê¸¸ë™',
                phone: '010-1234-5678',
                startDate: new Date(2025, 8, 15), // 9ì›” 15ì¼
                duration: 3,
                status: 'confirmed'
            },
            {
                id: 3,
                name: 'í™ê¸¸ë™',
                phone: '010-1234-5678',
                startDate: new Date(2025, 6, 5), // 7ì›” 5ì¼ (ê³¼ê±°)
                duration: 1,
                status: 'completed'
            }
        ];

        document.addEventListener('DOMContentLoaded', function() {
            // Set theme
            ThemeManager.setModifyTheme();
            
            // Initialize input formatters
            InputFormatter.initializeAllFormatters();
            
            // Initialize components
            stepNavigator = new StepNavigator(3);
            
            // Initialize main calendar (read-only for viewing reservations only)
            calendar = new OksCalendar({
                containerId: 'calendar-container',
                primaryColor: '#e67e22',
                rangeBgColor: '#fdeaa7',
                rangeTextColor: '#d35400',
                onDateSelect: null, // Disable date selection
                onMonthChange: handleMonthChange,
                readOnly: true // Make calendar read-only - no date selection allowed
            });

            // Check if we need to go to step 2 (from reservation modification)
            if (window.location.hash === '#step2') {
                // Show step 2 directly - simulate going through step 1
                stepNavigator.hideStep(1);
                stepNavigator.markStepCompleted(1);
                stepNavigator.showStep(2);
                stepNavigator.markStepActive(2);
                
                // Load some mock data for demonstration
                document.getElementById('auth-name').value = 'í™ê¸¸ë™';
                document.getElementById('auth-phone').value = '010-1234-5678';
                document.getElementById('password').value = '1234';
                
                // Load reservations
                loadUserReservations();
            }
        });

        // Event handlers
        function nextStep(currentStep) {
            const validationFunctions = {
                1: () => {
                    const name = document.getElementById('auth-name').value;
                    const phone = document.getElementById('auth-phone').value;
                    const password = document.getElementById('password').value;
                    
                    if (!FormValidator.validateAuthInfo(name, phone, password)) {
                        return false;
                    }
                    
                    // ì…ë ¥ëœ ì •ë³´ë¡œ ì˜ˆì•½ ê²€ìƒ‰ (ì‹¤ì œë¡œëŠ” ì„œë²„ API í˜¸ì¶œ)
                    const userReservations = findUserReservations(name, phone, password);
                    if (userReservations.length === 0) {
                        alert('ì¼ì¹˜í•˜ëŠ” ì˜ˆì•½ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        return false;
                    }
                    
                    return true;
                },
                2: () => {
                    if (!selectedReservation) {
                        alert('ë³€ê²½í•  ì˜ˆì•½ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                        return false;
                    }
                    return true;
                }
            };

            const nextStepNum = stepNavigator.nextStep(currentStep, validationFunctions[currentStep]);
            
            if (nextStepNum === 2) {
                loadUserReservations();
            } else if (nextStepNum === 3) {
                showSelectedReservation();
            }
            
            return nextStepNum;
        }

        function prevStep(currentStep) {
            console.log('prevStep called with:', currentStep);
            
            if (currentStep === 3) {
                console.log('Going from step 3 to reservation.html step 2');
                // Going from step 3 (manage.html) back to reservation.html step 2
                hideModifyForm();
                
                // Store reservation data for returning to reservation.html
                const modificationData = {
                    isModification: true,
                    originalReservation: selectedReservation,
                    userInfo: {
                        name: document.getElementById('auth-name').value,
                        phone: document.getElementById('auth-phone').value,
                        password: document.getElementById('password').value
                    },
                    returnToStep: 2  // Return to step 2 (date selection)
                };

                console.log('Storing modificationData:', modificationData);
                sessionStorage.setItem('modificationData', JSON.stringify(modificationData));
                console.log('Redirecting to reservation.html');
                window.location.href = 'reservation.html';
                return;
            }
            
            const prevStepNum = stepNavigator.prevStep(currentStep, (current, prev) => {
                if (current === 2) {
                    selectedReservation = null;
                    document.getElementById('reservations-list').innerHTML = '';
                    // Clear calendar highlights when going back from step 2
                    clearCalendarHighlights();
                }
            });
        }

        function findUserReservations(name, phone, password) {
            // ì‹¤ì œë¡œëŠ” ì„œë²„ APIë¥¼ í˜¸ì¶œí•˜ì—¬ ì‚¬ìš©ì ì˜ˆì•½ì„ ì¡°íšŒ
            const allUserReservations = mockReservations.filter(res => 
                res.name === name && res.phone === phone
            );
            
            // ì™„ë£Œëœ ì˜ˆì•½ê³¼ ì´ìš© ì¤‘ì¸ ì˜ˆì•½ì€ ì œì™¸í•˜ê³  ì˜ˆì•½ í™•ì • ìƒíƒœë§Œ í‘œì‹œ
            return allUserReservations.filter(reservation => {
                const status = ReservationManager.getReservationStatus(
                    reservation.startDate, 
                    reservation.duration
                );
                return status === 'upcoming';
            });
        }

        function loadUserReservations() {
            const name = document.getElementById('auth-name').value;
            const phone = document.getElementById('auth-phone').value;
            const password = document.getElementById('password').value;
            
            const userReservations = findUserReservations(name, phone, password);
            displayReservations(userReservations);
            // Remove automatic highlighting - let calendar stay clean initially
            // highlightReservationsOnCalendar(userReservations);
        }

        function displayReservations(reservations) {
            const listContainer = document.getElementById('reservations-list');
            
            if (reservations.length === 0) {
                listContainer.innerHTML = `
                    <div class="no-reservations">
                        <p style="font-size: var(--text-lg); color: var(--neutral-600); text-align: center; padding: var(--space-8);">
                            í˜„ì¬ ë³€ê²½ ê°€ëŠ¥í•œ ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤.
                        </p>
                        <div style="background: rgba(245, 158, 11, 0.1); padding: var(--space-4); border-radius: var(--radius-lg); margin-top: var(--space-4);">
                            <p style="font-size: var(--text-base); color: var(--neutral-600); margin: 0; line-height: 1.6;">
                                â„¹ï¸ <strong>ì•ˆë‚´:</strong> ì´ë¯¸ ì¢…ë£Œëœ ì˜ˆì•½ì´ë‚˜ í˜„ì¬ ì´ìš© ì¤‘ì¸ ì˜ˆì•½ì€ ë³€ê²½í•  ìˆ˜ ì—†ì–´ ëª©ë¡ì— í‘œì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                            </p>
                        </div>
                    </div>
                `;
                return;
            }
            
            listContainer.innerHTML = reservations.map(reservation => 
                ReservationManager.createReservationCard(reservation)
            ).join('');
            
            // Auto-select the first reservation
            if (reservations.length > 0) {
                setTimeout(() => {
                    selectReservation(reservations[0].id);
                }, 100);
            }
        }

        function highlightReservationsOnCalendar(reservations) {
            setTimeout(() => {
                // ê¸°ì¡´ í•˜ì´ë¼ì´íŠ¸ ì œê±°
                clearCalendarHighlights();
                
                // ëª¨ë“  ì˜ˆì•½ì„ ì—°í•œ ìƒ‰ìœ¼ë¡œ í‘œì‹œ (ì„ íƒë˜ì§€ ì•Šì€ ìƒíƒœ)
                reservations.forEach(reservation => {
                    for (let i = 0; i < reservation.duration; i++) {
                        const date = new Date(reservation.startDate);
                        date.setDate(reservation.startDate.getDate() + i);
                        highlightOtherReservationDate(date);
                    }
                });
            }, 100);
        }

        function selectReservation(reservationId) {
            // ê¸°ì¡´ ì„ íƒ í•´ì œ
            document.querySelectorAll('.reservation-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // ìƒˆë¡œìš´ ì„ íƒ - ì´ë²¤íŠ¸ê°€ ìˆì„ ë•Œì™€ ì—†ì„ ë•Œ ëª¨ë‘ ì²˜ë¦¬
            const targetCard = document.querySelector(`[data-reservation-id="${reservationId}"]`);
            if (targetCard) {
                targetCard.classList.add('selected');
            }
            
            selectedReservation = mockReservations.find(res => res.id === reservationId);
            
            // ë‹¬ë ¥ì„ ì„ íƒëœ ì˜ˆì•½ì˜ ì‹œì‘ë‚ ì§œ ë‹¬ë¡œ ì´ë™í•˜ê³  ì˜ˆì•½ ê¸°ê°„ í‘œì‹œ
            if (selectedReservation && calendar) {
                // ê¸°ì¡´ ìŠ¤íƒ€ì¼ ì œê±°
                clearCalendarHighlights();
                
                // ë¨¼ì € ë‹¬ë ¥ì„ í•´ë‹¹ ì›”ë¡œ ì´ë™
                calendar.navigateToDate(selectedReservation.startDate);
                
                // ë‹¬ë ¥ì˜ durationì„ ì„¤ì •í•˜ê³  ì„ íƒëœ ì˜ˆì•½ì„ í‘œì‹œ
                calendar.setDuration(selectedReservation.duration);
                
                // ì„ íƒëœ ì˜ˆì•½ì„ ë‹¬ë ¥ì— í‘œì‹œ
                setTimeout(() => {
                    calendar.selectDate(selectedReservation.startDate);
                    
                    // ë‹¤ë¥¸ ì˜ˆì•½ë“¤ë„ í•˜ì´ë¼ì´íŠ¸ (ì„ íƒëœ ì˜ˆì•½ê³¼ êµ¬ë¶„í•˜ê¸° ìœ„í•´)
                    const name = document.getElementById('auth-name').value;
                    const phone = document.getElementById('auth-phone').value;
                    if (name && phone) {
                        const userReservations = findUserReservations(name, phone, '');
                        highlightOtherReservations(userReservations, selectedReservation.id);
                    }
                }, 200);
            }
            
            // ë³€ê²½ ë° ì·¨ì†Œ ë²„íŠ¼ í™œì„±í™”
            const nextBtn = document.getElementById('nextBtn2');
            const cancelBtn = document.getElementById('cancelBtn2');
            
            nextBtn.disabled = false;
            nextBtn.style.opacity = '1';
            nextBtn.style.cursor = 'pointer';
            
            cancelBtn.disabled = false;
            cancelBtn.style.opacity = '1';
            cancelBtn.style.cursor = 'pointer';
        }

        function highlightOtherReservations(reservations, selectedId) {
            // ì„ íƒëœ ì˜ˆì•½ì´ ì•„ë‹Œ ë‹¤ë¥¸ ì˜ˆì•½ë“¤ì„ ë‹¤ë¥¸ ìŠ¤íƒ€ì¼ë¡œ í‘œì‹œ
            const otherReservations = reservations.filter(res => res.id !== selectedId);
            
            otherReservations.forEach(reservation => {
                for (let i = 0; i < reservation.duration; i++) {
                    const date = new Date(reservation.startDate);
                    date.setDate(reservation.startDate.getDate() + i);
                    highlightOtherReservationDate(date);
                }
            });
        }

        function highlightOtherReservationDate(date) {
            // í˜„ì¬ ë‹¬ë ¥ì— í‘œì‹œëœ ì›”/ë…„ê³¼ ë‚ ì§œì˜ ì›”/ë…„ì´ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
            const currentCalendarMonth = calendar.getCurrentMonth();
            
            if (date.getMonth() === currentCalendarMonth.month && 
                date.getFullYear() === currentCalendarMonth.year) {
                
                const dateString = date.getDate().toString();
                const calendarDays = document.querySelectorAll('.calendar-day');
                
                calendarDays.forEach(day => {
                    if (day.textContent === dateString && 
                        !day.classList.contains('other-month') && 
                        !day.classList.contains('selected') && 
                        !day.classList.contains('in-range')) {
                        // ë‹¤ë¥¸ ì˜ˆì•½ì€ ë” ì—°í•œ ì˜¤ë Œì§€ìƒ‰ìœ¼ë¡œ í‘œì‹œ
                        day.style.backgroundColor = '#fef3e2';
                        day.style.border = '1px solid #f39c12';
                        day.style.color = '#d35400';
                    }
                });
            }
        }

        function clearCalendarHighlights() {
            // ëª¨ë“  ë‹¬ë ¥ í•˜ì´ë¼ì´íŠ¸ ì œê±°
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.classList.remove('reservation-highlight');
                day.style.backgroundColor = '';
                day.style.border = '';
                day.style.color = '';
            });
        }

        function showSelectedReservation() {
            if (!selectedReservation) return;
            
            const endDate = new Date(selectedReservation.startDate);
            endDate.setDate(selectedReservation.startDate.getDate() + selectedReservation.duration);
            
            const infoElement = document.getElementById('selected-reservation-info');
            infoElement.innerHTML = `
                <h4>í˜„ì¬ ì˜ˆì•½ ì •ë³´</h4>
                <p><strong>ì˜ˆì•½ì:</strong> ${selectedReservation.name}</p>
                <p><strong>ì˜ˆì•½ ë‚ ì§œ:</strong> ${ReservationManager.formatKoreanDate(selectedReservation.startDate)} ~ ${ReservationManager.formatKoreanDate(endDate)}</p>
                <p><strong>ìˆ™ë°• ê¸°ê°„:</strong> ${selectedReservation.duration}ë°• ${selectedReservation.duration + 1}ì¼</p>
                <p><strong>ì „í™”ë²ˆí˜¸:</strong> ${selectedReservation.phone}</p>
            `;
            
            // í¼ì— ê¸°ë³¸ê°’ ì„¤ì •
            document.getElementById('new-name').value = selectedReservation.name;
            document.getElementById('new-phone').value = selectedReservation.phone;
        }

        function showModifyForm() {
            const modifyForm = document.getElementById('modify-form');
            const modifyBtn = document.getElementById('modify-btn');
            const deleteBtn = document.getElementById('delete-btn');
            const saveBtn = document.getElementById('save-btn');
            
            modifyForm.style.display = 'block';
            modifyBtn.style.display = 'none';
            deleteBtn.style.display = 'none';
            saveBtn.style.display = 'inline-block';
            
            // Initialize modify calendar
            if (!modifyCalendar) {
                modifyCalendar = new OksCalendar({
                    containerId: 'modify-calendar-container',
                    dateRangeDisplayId: 'dateRangeDisplay',
                    nextButtonId: 'save-btn',
                    primaryColor: '#e67e22',
                    rangeBgColor: '#fdeaa7',
                    rangeTextColor: '#d35400'
                });
            }
        }

        function hideModifyForm() {
            const modifyForm = document.getElementById('modify-form');
            const modifyBtn = document.getElementById('modify-btn');
            const deleteBtn = document.getElementById('delete-btn');
            const saveBtn = document.getElementById('save-btn');
            
            modifyForm.style.display = 'none';
            modifyBtn.style.display = 'inline-block';
            deleteBtn.style.display = 'inline-block';
            saveBtn.style.display = 'none';
        }

        function selectDuration(days, button) {
            // Duration button selection logic
            document.querySelectorAll('.duration-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            button.classList.add('selected');
            
            if (modifyCalendar) {
                modifyCalendar.setDuration(days);
            }
        }

        function deleteReservation() {
            if (!selectedReservation) return;
            
            const confirmDelete = confirm(`ì •ë§ë¡œ ì´ ì˜ˆì•½ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì˜ˆì•½ ë‚ ì§œ: ${ReservationManager.formatKoreanDate(selectedReservation.startDate)}\nì˜ˆì•½ì: ${selectedReservation.name}`);
            
            if (confirmDelete) {
                // ì‹¤ì œë¡œëŠ” ì„œë²„ API í˜¸ì¶œ
                alert('ì˜ˆì•½ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                location.href = 'index.html';
            }
        }

        function completeModification() {
            if (!modifyCalendar || !modifyCalendar.getSelectedDate()) {
                FeedbackManager.showAlert('ìƒˆë¡œìš´ ì˜ˆì•½ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                return false;
            }
            
            const selectedDurationButton = document.querySelector('.duration-btn.selected');
            if (!selectedDurationButton) {
                FeedbackManager.showAlert('ìƒˆë¡œìš´ ìˆ™ë°• ê¸°ê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                return false;
            }
            
            // ì´ë¯¸ ì¸ì¦ëœ ì‚¬ìš©ì ì •ë³´ ì‚¬ìš©
            const userName = document.getElementById('auth-name').value;
            const userPhone = document.getElementById('auth-phone').value;
            
            // ë³€ê²½ëœ ì˜ˆì•½ ì •ë³´ë¡œ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
            const selectedDate = modifyCalendar.getSelectedDate();
            const duration = modifyCalendar.getDuration();
            const endDate = new Date(selectedDate);
            endDate.setDate(selectedDate.getDate() + duration);
            
            FeedbackManager.showSuccess(
                'ğŸ‰ ì˜ˆì•½ ë³€ê²½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!',
                `${userName}ë‹˜ì˜ ì˜ˆì•½ì´ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ì˜ˆì•½ ë‚ ì§œ: ${ReservationManager.formatKoreanDate(selectedDate)} ~ ${ReservationManager.formatKoreanDate(endDate)}<br>(${duration}ë°• ${duration + 1}ì¼)`,
                () => {
                    window.location.href = 'index.html';
                }
            );
        }
        
        function showModificationCompletionScreen() {
            const selectedDate = modifyCalendar.getSelectedDate();
            const duration = modifyCalendar.getDuration();
            const endDate = new Date(selectedDate);
            endDate.setDate(selectedDate.getDate() + duration);
            
            const newName = document.getElementById('new-name').value;
            const newPhone = document.getElementById('new-phone').value;
            
            // ì»¨í…Œì´ë„ˆ ë‚´ìš©ì„ ì™„ë£Œ í™”ë©´ìœ¼ë¡œ êµì²´
            document.querySelector('.container').innerHTML = `
                <div style="text-align: center; padding: 40px 20px;">
                    <div style="font-size: 4rem; margin-bottom: 20px;">ğŸ‰</div>
                    <h1 style="color: var(--success); font-size: 2.5rem; margin-bottom: 20px; font-weight: 700;">
                        ì˜ˆì•½ ë³€ê²½ ì™„ë£Œ!
                    </h1>
                    <div style="background: rgba(4, 120, 87, 0.1); border: 2px solid var(--success); border-radius: 20px; padding: 30px; margin: 30px 0; text-align: left;">
                        <h3 style="color: var(--success); margin-top: 0; margin-bottom: 20px; text-align: center;">
                            ğŸ“… ë³€ê²½ëœ ì˜ˆì•½ ì •ë³´
                        </h3>
                        <div style="font-size: 1.1rem; line-height: 1.8; color: var(--neutral-800);">
                            <p><strong>ğŸ“ ì˜ˆì•½ì:</strong> ${newName}</p>
                            <p><strong>ğŸ“ ì „í™”ë²ˆí˜¸:</strong> ${newPhone}</p>
                            <p><strong>ğŸ—“ï¸ ì˜ˆì•½ ë‚ ì§œ:</strong> ${ReservationManager.formatKoreanDate(selectedDate)} ~ ${ReservationManager.formatKoreanDate(endDate)}</p>
                            <p><strong>ğŸ  ìˆ™ë°• ê¸°ê°„:</strong> ${duration}ë°• ${duration + 1}ì¼</p>
                        </div>
                    </div>
                    <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 16px; padding: 20px; margin: 20px 0;">
                        <p style="margin: 0; color: var(--warning); font-weight: 600;">
                            ğŸ¡ Ok's ëŸ¬ë¸Œí•˜ìš°ìŠ¤ì—ì„œ í¸ì•ˆí•œ ì‹œê°„ ë³´ë‚´ì‹œê¸¸ ë°”ëë‹ˆë‹¤!
                        </p>
                    </div>
                    <button class="btn" onclick="location.href='index.html'" style="
                        font-size: 1.2rem;
                        padding: 16px 32px;
                        margin-top: 30px;
                        background: linear-gradient(135deg, var(--success) 0%, #047857 100%);
                        border: none;
                        box-shadow: 0 8px 25px rgba(4, 120, 87, 0.3);
                    ">
                        ğŸ  ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                    </button>
                </div>
            `;
        }

        function handleCalendarDateSelect(date, duration) {
            // Calendar date selection handler
            console.log('Calendar date selected:', date, duration);
        }

        function handleMonthChange(month, year) {
            // Month change handler
            console.log('Month changed to:', year, month + 1);
            
            // Only re-highlight if a reservation is currently selected
            if (selectedReservation) {
                // Re-highlight the selected reservation and other reservations
                const name = document.getElementById('auth-name').value;
                const phone = document.getElementById('auth-phone').value;
                if (name && phone) {
                    const userReservations = findUserReservations(name, phone, '');
                    setTimeout(() => {
                        // Clear and re-apply highlights for selected reservation
                        clearCalendarHighlights();
                        calendar.selectDate(selectedReservation.startDate);
                        highlightOtherReservations(userReservations, selectedReservation.id);
                    }, 100);
                }
            }
        }

        function startReservationModification() {
            if (!selectedReservation) {
                FeedbackManager.showAlert('ë³€ê²½í•  ì˜ˆì•½ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            // Store reservation data and user info for the reservation page
            const modificationData = {
                isModification: true,
                originalReservation: selectedReservation,
                userInfo: {
                    name: document.getElementById('auth-name').value,
                    phone: document.getElementById('auth-phone').value,
                    password: document.getElementById('password').value
                }
            };

            // Store in sessionStorage for the reservation page to use
            sessionStorage.setItem('modificationData', JSON.stringify(modificationData));

            // Redirect to reservation page
            window.location.href = 'reservation.html';
        }

        function cancelSelectedReservation() {
            if (!selectedReservation) {
                FeedbackManager.showAlert('ì·¨ì†Œí•  ì˜ˆì•½ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            const endDate = new Date(selectedReservation.startDate);
            endDate.setDate(selectedReservation.startDate.getDate() + selectedReservation.duration);

            // ì‚¬ìš©ì í™•ì¸ íŒì—…
            FeedbackManager.showConfirm(
                `ì´ ì˜ˆì•½ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`,
                `ì˜ˆì•½ì: ${selectedReservation.name}<br>ì²´í¬ì¸: ${ReservationManager.formatKoreanDate(selectedReservation.startDate)}<br>ì²´í¬ì•„ì›ƒ: ${ReservationManager.formatKoreanDate(endDate)}<br>ê¸°ê°„: ${selectedReservation.duration}ë°• ${selectedReservation.duration + 1}ì¼`,
                () => {
                    // í™•ì¸ì„ ì„ íƒí•œ ê²½ìš° - ì·¨ì†Œ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                    FeedbackManager.showSuccess(
                        'ğŸ‘ŒğŸ» ì˜ˆì•½ ì·¨ì†Œ ì™„ë£Œ!',
                        `${selectedReservation.name}ë‹˜ì˜ ì˜ˆì•½ì´ ì„±ê³µì ìœ¼ë¡œ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.`,
                        () => {
                            window.location.href = 'index.html';
                        }
                    );
                },
                () => {
                    // ì·¨ì†Œë¥¼ ì„ íƒí•œ ê²½ìš° - ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
                    console.log('ì˜ˆì•½ ì·¨ì†Œ ì·¨ì†Œë¨');
                }
            );
        }
        
    </script>
</body>
</html>