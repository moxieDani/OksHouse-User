<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜ˆì•½ í™•ì¸/ë³€ê²½ - Ok's House</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/calendar.css">
    <link rel="stylesheet" href="css/privacy.css">
    <style>
        h1 {
            color: #e67e22;
        }
        .step h3 {
            color: #e67e22;
        }
        .btn {
            background: #e67e22;
        }
        .btn:hover {
            background: #d35400;
        }
        .current-reservation {
            background: #fdf6f0;
            padding: 15px;
            border-left: 4px solid #e67e22;
            margin: 15px 0;
        }
        /* Override calendar colors for manage page */
        .step-dot.active {
            background: #e67e22 !important;
        }
        .step-dot.completed {
            background: #d35400 !important;
        }
        .date-range-display.selected {
            background: #fdeaa7 !important;
            color: #d35400 !important;
            border-color: #e67e22 !important;
        }
        .reservation-card {
            background: #fefefe;
            border: 2px solid #f4f4f4;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .reservation-card:hover {
            border-color: #e67e22;
            box-shadow: 0 4px 12px rgba(230, 126, 34, 0.15);
            background: #fdf9f5;
        }
        .reservation-card.selected {
            border-color: #e67e22;
            background: #fdf6f0;
            box-shadow: 0 4px 12px rgba(230, 126, 34, 0.25);
        }
        .reservation-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        .reservation-details {
            flex: 1;
        }
        .reservation-status {
            background: #f39c12;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        .reservation-status.past {
            background: #bdc3c7;
        }
        .reservation-status.current {
            background: #e67e22;
        }
        .reservation-status.upcoming {
            background: #f39c12;
        }
        .reservation-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        #delete-btn:hover {
            background: #c0392b !important;
        }
        .no-reservations {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
            font-size: 16px;
        }
        .calendar-view {
            margin-top: 20px;
        }
        .reservation-highlight {
            background: #e67e22 !important;
            color: white !important;
            font-weight: bold;
        }
        .modify-form {
            background: #fdf6f0;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 2px solid #e67e22;
        }
        .modify-form h4 {
            color: #e67e22;
            margin-top: 0;
        }
        /* Duration buttons orange theme */
        .duration-btn.selected {
            background: #e67e22 !important;
            color: white !important;
            border-color: #d35400 !important;
        }
        .duration-btn:hover {
            border-color: #e67e22 !important;
            color: #e67e22 !important;
        }
        /* Calendar section styling */
        .calendar-view h4 {
            color: #e67e22;
            border-bottom: 2px solid #e67e22;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }
        #reservations-list h4 {
            color: #e67e22;
            border-bottom: 2px solid #e67e22;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }
        /* Form labels */
        .form-group label {
            color: #d35400;
            font-weight: 600;
        }
        /* Hide today highlight in manage page */
        .calendar-day.today {
            background: transparent !important;
            color: inherit !important;
            font-weight: normal !important;
        }
        /* Make calendar read-only in step 2 */
        #step2 .calendar-day {
            cursor: default !important;
            pointer-events: none !important;
        }
        #step2 .calendar-day:hover {
            background: transparent !important;
            color: inherit !important;
        }
        /* Ensure no interaction styling in read-only mode */
        #step2 .calendar-day.selected:hover,
        #step2 .calendar-day.in-range:hover {
            background: inherit !important;
            color: inherit !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“‹ ì˜ˆì•½ í™•ì¸/ë³€ê²½</h1>
        
        <!-- Step Indicator -->
        <div class="step-indicator">
            <span class="step-dot active" id="dot1">1</span>
            <span class="step-dot" id="dot2">2</span>
            <span class="step-dot" id="dot3">3</span>
        </div>
        
        <!-- Step 1: ì˜ˆì•½ì ì •ë³´ ì…ë ¥ -->
        <div class="step" id="step1">
            <h3>1ë‹¨ê³„: ì˜ˆì•½ì ì •ë³´ ì…ë ¥</h3>
            <div class="form-group">
                <label for="auth-name">ì´ë¦„:</label>
                <input type="text" id="auth-name" placeholder="ì˜ˆì•½ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="form-group">
                <label for="auth-phone">ì „í™”ë²ˆí˜¸:</label>
                <input type="tel" id="auth-phone" placeholder="010-1234-5678">
            </div>
            <div class="form-group">
                <label for="password">ë¹„ë°€ë²ˆí˜¸:</label>
                <input type="password" id="password" placeholder="4ìë¦¬ ìˆ«ì ë¹„ë°€ë²ˆí˜¸">
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-back" onclick="location.href='index.html'">ì´ì „</button>
                <button class="btn" onclick="nextStep(1)">í™•ì¸</button>
            </div>
        </div>

        <!-- Step 2: ì˜ˆì•½ ëª©ë¡ í™•ì¸ -->
        <div class="step hidden" id="step2">
            <h3>2ë‹¨ê³„: ì˜ˆì•½ í˜„í™© í™•ì¸</h3>
            
            <!-- ë‹¬ë ¥ ë³´ê¸° -->
            <div class="calendar-view">
                <div id="calendar-container"></div>
            </div>
            
            <!-- ì˜ˆì•½ ëª©ë¡ -->
            <div style="margin-top: 30px;">
                <h4>ğŸ“‹ ì˜ˆì•½ ëª©ë¡</h4>
                <div id="reservations-list">
                    <!-- ì˜ˆì•½ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-back" onclick="prevStep(2)">ì´ì „</button>
                <button class="btn" id="nextBtn2" onclick="startReservationModification()" disabled style="opacity: 0.5; cursor: not-allowed;">ì„ íƒí•œ ì˜ˆì•½ ë³€ê²½</button>
            </div>
        </div>

        <!-- Step 3: ì˜ˆì•½ ë³€ê²½/ì‚­ì œ -->
        <div class="step hidden" id="step3">
            <h3>3ë‹¨ê³„: ì˜ˆì•½ ë³€ê²½</h3>
            
            <!-- í˜„ì¬ ì„ íƒëœ ì˜ˆì•½ ì •ë³´ -->
            <div class="current-reservation" id="selected-reservation-info">
                ì„ íƒëœ ì˜ˆì•½ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤
            </div>
            
            <!-- ë³€ê²½ ì˜µì…˜ -->
            <div class="modify-form" id="modify-form" style="display: none;">
                <h4>ìƒˆë¡œìš´ ì˜ˆì•½ ì •ë³´</h4>
                
                <!-- ìƒˆë¡œìš´ ìˆ™ë°• ê¸°ê°„ ì„ íƒ -->
                <div class="form-group">
                    <label>ìƒˆë¡œìš´ ìˆ™ë°• ê¸°ê°„:</label>
                    <div class="duration-buttons">
                        <button class="duration-btn" onclick="selectDuration(1, this)">1ë°• 2ì¼</button>
                        <button class="duration-btn" onclick="selectDuration(2, this)">2ë°• 3ì¼</button>
                        <button class="duration-btn" onclick="selectDuration(3, this)">3ë°• 4ì¼</button>
                        <button class="duration-btn" onclick="selectDuration(4, this)">4ë°• 5ì¼</button>
                        <button class="duration-btn" onclick="selectDuration(5, this)">5ë°• 6ì¼</button>
                        <button class="duration-btn" onclick="selectDuration(6, this)">6ë°• 7ì¼</button>
                        <button class="duration-btn" onclick="selectDuration(7, this)">7ë°• 8ì¼</button>
                        <button class="duration-btn" onclick="selectDuration(8, this)">8ë°• 9ì¼</button>
                        <button class="duration-btn" onclick="selectDuration(9, this)">9ë°• 10ì¼</button>
                        <button class="duration-btn" onclick="selectDuration(10, this)">10ë°• 11ì¼</button>
                    </div>
                </div>
                
                <!-- ìƒˆë¡œìš´ ë‚ ì§œ ì„ íƒ -->
                <div class="form-group" style="margin-top: 20px;">
                    <label>ìƒˆë¡œìš´ ì˜ˆì•½ ë‚ ì§œ:</label>
                    <div class="date-range-display" id="dateRangeDisplay">
                        ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”
                    </div>
                    <div id="modify-calendar-container"></div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-back" onclick="prevStep(3)">ì´ì „</button>
                <button class="btn" onclick="showModifyForm()" id="modify-btn">ì˜ˆì•½ ë³€ê²½</button>
                <button class="btn" onclick="deleteReservation()" id="delete-btn" style="background: #e74c3c;">ì˜ˆì•½ ì‚­ì œ</button>
                <button class="btn" onclick="completeModification()" id="save-btn" style="display: none;">ë³€ê²½ ì €ì¥</button>
            </div>
        </div>
    </div>

    <script src="js/common.js"></script>
    <script src="js/calendar.js"></script>
    <script src="js/privacy.js"></script>
    <script>
        // Initialize components
        let stepNavigator, calendar, modifyCalendar, selectedReservation = null;
        
        // Mock reservation data - ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ ê°€ì ¸ì˜¬ ë°ì´í„°
        const mockReservations = [
            {
                id: 1,
                name: 'í™ê¸¸ë™',
                phone: '010-1234-5678',
                startDate: new Date(2025, 7, 10), // 8ì›” 10ì¼
                duration: 2,
                status: 'confirmed'
            },
            {
                id: 2,
                name: 'í™ê¸¸ë™',
                phone: '010-1234-5678',
                startDate: new Date(2025, 8, 15), // 9ì›” 15ì¼
                duration: 3,
                status: 'confirmed'
            },
            {
                id: 3,
                name: 'í™ê¸¸ë™',
                phone: '010-1234-5678',
                startDate: new Date(2025, 6, 5), // 7ì›” 5ì¼ (ê³¼ê±°)
                duration: 1,
                status: 'completed'
            }
        ];

        document.addEventListener('DOMContentLoaded', function() {
            // Set theme
            ThemeManager.setModifyTheme();
            
            // Initialize input formatters
            InputFormatter.initializeAllFormatters();
            
            // Initialize components
            stepNavigator = new StepNavigator(3);
            
            // Initialize main calendar (read-only for viewing reservations only)
            calendar = new OksCalendar({
                containerId: 'calendar-container',
                primaryColor: '#e67e22',
                rangeBgColor: '#fdeaa7',
                rangeTextColor: '#d35400',
                onDateSelect: null, // Disable date selection
                onMonthChange: handleMonthChange,
                readOnly: true // Make calendar read-only - no date selection allowed
            });

            // Check if we need to go to step 2 (from reservation modification)
            if (window.location.hash === '#step2') {
                // Show step 2 directly - simulate going through step 1
                stepNavigator.hideStep(1);
                stepNavigator.markStepCompleted(1);
                stepNavigator.showStep(2);
                stepNavigator.markStepActive(2);
                
                // Load some mock data for demonstration
                document.getElementById('auth-name').value = 'í™ê¸¸ë™';
                document.getElementById('auth-phone').value = '010-1234-5678';
                document.getElementById('password').value = '1234';
                
                // Load reservations
                loadUserReservations();
            }
        });

        // Event handlers
        function nextStep(currentStep) {
            const validationFunctions = {
                1: () => {
                    const name = document.getElementById('auth-name').value;
                    const phone = document.getElementById('auth-phone').value;
                    const password = document.getElementById('password').value;
                    
                    if (!FormValidator.validateAuthInfo(name, phone, password)) {
                        return false;
                    }
                    
                    // ì…ë ¥ëœ ì •ë³´ë¡œ ì˜ˆì•½ ê²€ìƒ‰ (ì‹¤ì œë¡œëŠ” ì„œë²„ API í˜¸ì¶œ)
                    const userReservations = findUserReservations(name, phone, password);
                    if (userReservations.length === 0) {
                        alert('ì¼ì¹˜í•˜ëŠ” ì˜ˆì•½ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        return false;
                    }
                    
                    return true;
                },
                2: () => {
                    if (!selectedReservation) {
                        alert('ë³€ê²½í•  ì˜ˆì•½ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                        return false;
                    }
                    return true;
                }
            };

            const nextStepNum = stepNavigator.nextStep(currentStep, validationFunctions[currentStep]);
            
            if (nextStepNum === 2) {
                loadUserReservations();
            } else if (nextStepNum === 3) {
                showSelectedReservation();
            }
            
            return nextStepNum;
        }

        function prevStep(currentStep) {
            const prevStepNum = stepNavigator.prevStep(currentStep, (current, prev) => {
                if (current === 3) {
                    hideModifyForm();
                } else if (current === 2) {
                    selectedReservation = null;
                    document.getElementById('reservations-list').innerHTML = '';
                    // Clear calendar highlights when going back from step 2
                    clearCalendarHighlights();
                }
            });
        }

        function findUserReservations(name, phone, password) {
            // ì‹¤ì œë¡œëŠ” ì„œë²„ APIë¥¼ í˜¸ì¶œí•˜ì—¬ ì‚¬ìš©ì ì˜ˆì•½ì„ ì¡°íšŒ
            const allUserReservations = mockReservations.filter(res => 
                res.name === name && res.phone === phone
            );
            
            // ì™„ë£Œëœ ì˜ˆì•½ê³¼ ì´ìš© ì¤‘ì¸ ì˜ˆì•½ì€ ì œì™¸í•˜ê³  ì˜ˆì•½ í™•ì • ìƒíƒœë§Œ í‘œì‹œ
            return allUserReservations.filter(reservation => {
                const status = ReservationManager.getReservationStatus(
                    reservation.startDate, 
                    reservation.duration
                );
                return status === 'upcoming';
            });
        }

        function loadUserReservations() {
            const name = document.getElementById('auth-name').value;
            const phone = document.getElementById('auth-phone').value;
            const password = document.getElementById('password').value;
            
            const userReservations = findUserReservations(name, phone, password);
            displayReservations(userReservations);
            // Remove automatic highlighting - let calendar stay clean initially
            // highlightReservationsOnCalendar(userReservations);
        }

        function displayReservations(reservations) {
            const listContainer = document.getElementById('reservations-list');
            
            if (reservations.length === 0) {
                listContainer.innerHTML = `
                    <div class="no-reservations">
                        <p>ë³€ê²½ ê°€ëŠ¥í•œ ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p style="font-size: 14px; color: #95a5a6; margin-top: 10px;">
                            ì™„ë£Œëœ ì˜ˆì•½ê³¼ ì´ìš© ì¤‘ì¸ ì˜ˆì•½ì€ í‘œì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                        </p>
                    </div>
                `;
                return;
            }
            
            listContainer.innerHTML = reservations.map(reservation => 
                ReservationManager.createReservationCard(reservation)
            ).join('');
            
            // Auto-select the first reservation
            if (reservations.length > 0) {
                setTimeout(() => {
                    selectReservation(reservations[0].id);
                }, 100);
            }
        }

        function highlightReservationsOnCalendar(reservations) {
            setTimeout(() => {
                // ê¸°ì¡´ í•˜ì´ë¼ì´íŠ¸ ì œê±°
                clearCalendarHighlights();
                
                // ëª¨ë“  ì˜ˆì•½ì„ ì—°í•œ ìƒ‰ìœ¼ë¡œ í‘œì‹œ (ì„ íƒë˜ì§€ ì•Šì€ ìƒíƒœ)
                reservations.forEach(reservation => {
                    for (let i = 0; i < reservation.duration; i++) {
                        const date = new Date(reservation.startDate);
                        date.setDate(reservation.startDate.getDate() + i);
                        highlightOtherReservationDate(date);
                    }
                });
            }, 100);
        }

        function selectReservation(reservationId) {
            // ê¸°ì¡´ ì„ íƒ í•´ì œ
            document.querySelectorAll('.reservation-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // ìƒˆë¡œìš´ ì„ íƒ - ì´ë²¤íŠ¸ê°€ ìˆì„ ë•Œì™€ ì—†ì„ ë•Œ ëª¨ë‘ ì²˜ë¦¬
            const targetCard = document.querySelector(`[data-reservation-id="${reservationId}"]`);
            if (targetCard) {
                targetCard.classList.add('selected');
            }
            
            selectedReservation = mockReservations.find(res => res.id === reservationId);
            
            // ë‹¬ë ¥ì„ ì„ íƒëœ ì˜ˆì•½ì˜ ì‹œì‘ë‚ ì§œ ë‹¬ë¡œ ì´ë™í•˜ê³  ì˜ˆì•½ ê¸°ê°„ í‘œì‹œ
            if (selectedReservation && calendar) {
                // ê¸°ì¡´ ìŠ¤íƒ€ì¼ ì œê±°
                clearCalendarHighlights();
                
                // ë¨¼ì € ë‹¬ë ¥ì„ í•´ë‹¹ ì›”ë¡œ ì´ë™
                calendar.navigateToDate(selectedReservation.startDate);
                
                // ë‹¬ë ¥ì˜ durationì„ ì„¤ì •í•˜ê³  ì„ íƒëœ ì˜ˆì•½ì„ í‘œì‹œ
                calendar.setDuration(selectedReservation.duration);
                
                // ì„ íƒëœ ì˜ˆì•½ì„ ë‹¬ë ¥ì— í‘œì‹œ
                setTimeout(() => {
                    calendar.selectDate(selectedReservation.startDate);
                    
                    // ë‹¤ë¥¸ ì˜ˆì•½ë“¤ë„ í•˜ì´ë¼ì´íŠ¸ (ì„ íƒëœ ì˜ˆì•½ê³¼ êµ¬ë¶„í•˜ê¸° ìœ„í•´)
                    const name = document.getElementById('auth-name').value;
                    const phone = document.getElementById('auth-phone').value;
                    if (name && phone) {
                        const userReservations = findUserReservations(name, phone, '');
                        highlightOtherReservations(userReservations, selectedReservation.id);
                    }
                }, 200);
            }
            
            // ë‹¤ìŒ ë²„íŠ¼ í™œì„±í™”
            const nextBtn = document.getElementById('nextBtn2');
            nextBtn.disabled = false;
            nextBtn.style.opacity = '1';
            nextBtn.style.cursor = 'pointer';
        }

        function highlightOtherReservations(reservations, selectedId) {
            // ì„ íƒëœ ì˜ˆì•½ì´ ì•„ë‹Œ ë‹¤ë¥¸ ì˜ˆì•½ë“¤ì„ ë‹¤ë¥¸ ìŠ¤íƒ€ì¼ë¡œ í‘œì‹œ
            const otherReservations = reservations.filter(res => res.id !== selectedId);
            
            otherReservations.forEach(reservation => {
                for (let i = 0; i < reservation.duration; i++) {
                    const date = new Date(reservation.startDate);
                    date.setDate(reservation.startDate.getDate() + i);
                    highlightOtherReservationDate(date);
                }
            });
        }

        function highlightOtherReservationDate(date) {
            // í˜„ì¬ ë‹¬ë ¥ì— í‘œì‹œëœ ì›”/ë…„ê³¼ ë‚ ì§œì˜ ì›”/ë…„ì´ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
            const currentCalendarMonth = calendar.getCurrentMonth();
            
            if (date.getMonth() === currentCalendarMonth.month && 
                date.getFullYear() === currentCalendarMonth.year) {
                
                const dateString = date.getDate().toString();
                const calendarDays = document.querySelectorAll('.calendar-day');
                
                calendarDays.forEach(day => {
                    if (day.textContent === dateString && 
                        !day.classList.contains('other-month') && 
                        !day.classList.contains('selected') && 
                        !day.classList.contains('in-range')) {
                        // ë‹¤ë¥¸ ì˜ˆì•½ì€ ë” ì—°í•œ ì˜¤ë Œì§€ìƒ‰ìœ¼ë¡œ í‘œì‹œ
                        day.style.backgroundColor = '#fef3e2';
                        day.style.border = '1px solid #f39c12';
                        day.style.color = '#d35400';
                    }
                });
            }
        }

        function clearCalendarHighlights() {
            // ëª¨ë“  ë‹¬ë ¥ í•˜ì´ë¼ì´íŠ¸ ì œê±°
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.classList.remove('reservation-highlight');
                day.style.backgroundColor = '';
                day.style.border = '';
                day.style.color = '';
            });
        }

        function showSelectedReservation() {
            if (!selectedReservation) return;
            
            const endDate = new Date(selectedReservation.startDate);
            endDate.setDate(selectedReservation.startDate.getDate() + selectedReservation.duration);
            
            const infoElement = document.getElementById('selected-reservation-info');
            infoElement.innerHTML = `
                <h4>í˜„ì¬ ì˜ˆì•½ ì •ë³´</h4>
                <p><strong>ì˜ˆì•½ì:</strong> ${selectedReservation.name}</p>
                <p><strong>ì˜ˆì•½ ë‚ ì§œ:</strong> ${ReservationManager.formatKoreanDate(selectedReservation.startDate)} ~ ${ReservationManager.formatKoreanDate(endDate)}</p>
                <p><strong>ìˆ™ë°• ê¸°ê°„:</strong> ${selectedReservation.duration}ë°• ${selectedReservation.duration + 1}ì¼</p>
                <p><strong>ì „í™”ë²ˆí˜¸:</strong> ${selectedReservation.phone}</p>
            `;
            
            // í¼ì— ê¸°ë³¸ê°’ ì„¤ì •
            document.getElementById('new-name').value = selectedReservation.name;
            document.getElementById('new-phone').value = selectedReservation.phone;
        }

        function showModifyForm() {
            const modifyForm = document.getElementById('modify-form');
            const modifyBtn = document.getElementById('modify-btn');
            const deleteBtn = document.getElementById('delete-btn');
            const saveBtn = document.getElementById('save-btn');
            
            modifyForm.style.display = 'block';
            modifyBtn.style.display = 'none';
            deleteBtn.style.display = 'none';
            saveBtn.style.display = 'inline-block';
            
            // Initialize modify calendar
            if (!modifyCalendar) {
                modifyCalendar = new OksCalendar({
                    containerId: 'modify-calendar-container',
                    dateRangeDisplayId: 'dateRangeDisplay',
                    nextButtonId: 'save-btn',
                    primaryColor: '#e67e22',
                    rangeBgColor: '#fdeaa7',
                    rangeTextColor: '#d35400'
                });
            }
        }

        function hideModifyForm() {
            const modifyForm = document.getElementById('modify-form');
            const modifyBtn = document.getElementById('modify-btn');
            const deleteBtn = document.getElementById('delete-btn');
            const saveBtn = document.getElementById('save-btn');
            
            modifyForm.style.display = 'none';
            modifyBtn.style.display = 'inline-block';
            deleteBtn.style.display = 'inline-block';
            saveBtn.style.display = 'none';
        }

        function selectDuration(days, button) {
            // Duration button selection logic
            document.querySelectorAll('.duration-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            button.classList.add('selected');
            
            if (modifyCalendar) {
                modifyCalendar.setDuration(days);
            }
        }

        function deleteReservation() {
            if (!selectedReservation) return;
            
            const confirmDelete = confirm(`ì •ë§ë¡œ ì´ ì˜ˆì•½ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì˜ˆì•½ ë‚ ì§œ: ${ReservationManager.formatKoreanDate(selectedReservation.startDate)}\nì˜ˆì•½ì: ${selectedReservation.name}`);
            
            if (confirmDelete) {
                // ì‹¤ì œë¡œëŠ” ì„œë²„ API í˜¸ì¶œ
                alert('ì˜ˆì•½ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                location.href = 'index.html';
            }
        }

        function completeModification() {
            if (!modifyCalendar || !modifyCalendar.getSelectedDate()) {
                alert('ìƒˆë¡œìš´ ì˜ˆì•½ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return false;
            }
            
            const newName = document.getElementById('new-name').value;
            const newPhone = document.getElementById('new-phone').value;
            
            if (!newName || !newPhone) {
                alert('ì˜ˆì•½ì ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return false;
            }
            
            // ì‹¤ì œë¡œëŠ” ì„œë²„ API í˜¸ì¶œí•˜ì—¬ ì˜ˆì•½ ì •ë³´ ì—…ë°ì´íŠ¸
            alert('ì˜ˆì•½ì´ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!');
            location.href = 'index.html';
        }

        function handleCalendarDateSelect(date, duration) {
            // Calendar date selection handler
            console.log('Calendar date selected:', date, duration);
        }

        function handleMonthChange(month, year) {
            // Month change handler
            console.log('Month changed to:', year, month + 1);
            
            // Only re-highlight if a reservation is currently selected
            if (selectedReservation) {
                // Re-highlight the selected reservation and other reservations
                const name = document.getElementById('auth-name').value;
                const phone = document.getElementById('auth-phone').value;
                if (name && phone) {
                    const userReservations = findUserReservations(name, phone, '');
                    setTimeout(() => {
                        // Clear and re-apply highlights for selected reservation
                        clearCalendarHighlights();
                        calendar.selectDate(selectedReservation.startDate);
                        highlightOtherReservations(userReservations, selectedReservation.id);
                    }, 100);
                }
            }
        }

        function startReservationModification() {
            if (!selectedReservation) {
                alert('ë³€ê²½í•  ì˜ˆì•½ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            // Store reservation data and user info for the reservation page
            const modificationData = {
                isModification: true,
                originalReservation: selectedReservation,
                userInfo: {
                    name: document.getElementById('auth-name').value,
                    phone: document.getElementById('auth-phone').value,
                    password: document.getElementById('password').value
                }
            };

            // Store in sessionStorage for the reservation page to use
            sessionStorage.setItem('modificationData', JSON.stringify(modificationData));

            // Redirect to reservation page
            window.location.href = 'reservation.html';
        }
    </script>
</body>
</html>